{% extends "base.html" %}

{% block header %}
<link rel="stylesheet" href="{{base_dir}}style.css">
<link rel="stylesheet" href="{{base_dir}}syntax.css">
{% endblock %}

{% block content %}
<div class="source-area">
  <p class="source-path">{{info.relative_path}}</p>
  <div class="source-coverage">
    {% let percent = info.summary.lines.percent %}
    {% let color_text = "" %}
    {% include "color.html" %}
    <div>
      <p>Lines</p>
      <p class="{{color_text}}">{{"{:.2}"|format(info.summary.lines.percent)}} %</p>
    </div>
    {% let percent = info.summary.functions.percent %}
    {% let color_text = "" %}
    {% include "color.html" %}
    <div>
      <p>Functions</p>
      <p class="{{color_text}}">{{"{:.2}"|format(info.summary.functions.percent)}} %</p>
    </div>
    {% let percent = info.summary.regions.percent %}
    {% let color_text = "" %}
    {% include "color.html" %}
    <div>
      <p>Regions</p>
      <p class="{{color_text}}">{{"{:.2}"|format(info.summary.regions.percent)}} %</p>
    </div>
  </div>
  <table class="source-table">
    <thead>
      <tr>
        <th>Line</th>
        <th>Count</th>
        <th>Source
        {%- if let Some(line) = self.get_first() %}
          (<a href="#L{{line}}">jump to first uncovered line</a>)
        {% endif -%}
        </th>
      </tr>
    </thead>
    <tbody class="syntect-code">
      {%- for line in lines %}
      <tr>
        <td>
          <a name="L{{loop.index}}" href="#L{{loop.index}}">{{loop.index}}</a>
        </td>
        {% let coverage = self.get_coverage(loop.index) %}
        {% let class %}
        {% match coverage %}
          {% when Coverage::Covered(_) %}
            {% let class = "covered" %}
          {% when Coverage::Uncovered(0) %}
            {% let class = "uncovered" %}
          {% when Coverage::Uncovered(_) %}
            {% let class = "partially-covered" %}
          {% when Coverage::Unknown %}
            {% let class = "" %}
        {% endmatch %}
        <td{% if coverage_style == CoverageStyle::Gutter %} class="gutter {{class}}"{% endif %}>
          {% match coverage %}
            {% when Coverage::Covered(count) %}
              {{count}}
            {% when Coverage::Uncovered(count) %}
              {{count}}
            {% when Coverage::Unknown %}
          {% endmatch %}
        </td>
        <td{% if coverage_style == CoverageStyle::Line %} class="{{class}}"{% endif %}>
          <pre>{{line|safe}}</pre>
          {% if show_instantiations %}
            {% if let Some(functions) = self.info.uncalled.get(loop.index) %}
              <div class="source-message">
                <p>Missing instantiations:</p>
                {% for function in functions %}
                  <pre>{{function}}</pre>
                {% endfor %}
              </div>
            {% endif %}
          {% endif %}
        </td>
      </tr>
      {%- endfor %}
    </tbody>
  </table>
</div>

<p class="page-footer">
  Generated by <a href="{{PROJECT.repository}}">{{PROJECT.name}}</a> -- version {{PROJECT.version}}
</p>
{% endblock %}